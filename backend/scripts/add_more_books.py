"""
Скрипт для добавления дополнительных книг в базу данных.
Реальные популярные книги с правильными метаданными.
"""
import asyncio
import sys
from pathlib import Path

# Добавляем корневую директорию проекта в путь
sys.path.insert(0, str(Path(__file__).parent.parent))

from beanie import init_beanie
from motor.motor_asyncio import AsyncIOMotorClient

from app.core.config import settings
from app.models.book import Book


BOOKS_TO_ADD = [
    # Классическая литература
    {
        "title": "Война и мир",
        "author": "Лев Толстой",
        "isbn": "978-5-17-098034-5",
        "description": "Роман-эпопея о русском обществе в эпоху войн против Наполеона 1805—1812 годов. Одно из величайших произведений мировой литературы.",
        "genre": "Классическая литература",
        "publisher": "АСТ",
        "publication_year": 2015,
        "page_count": 1408,
        "language": "ru",
        "price": 1299.0,
        "stock": 25,
        "average_rating": 4.8,
        "tags": ["классика", "история", "война", "эпопея", "русская литература"],
    },
    {
        "title": "Преступление и наказание",
        "author": "Фёдор Достоевский",
        "isbn": "978-5-17-082912-3",
        "description": "Философско-психологический роман о бедном студенте Родионе Раскольникове, решившемся на убийство ради проверки своей теории о 'праве сильной личности'.",
        "genre": "Классическая литература",
        "publisher": "АСТ",
        "publication_year": 2014,
        "page_count": 608,
        "language": "ru",
        "price": 899.0,
        "stock": 30,
        "average_rating": 4.7,
        "tags": ["классика", "философия", "психология", "драма"],
    },
    {
        "title": "Мёртвые души",
        "author": "Николай Гоголь",
        "isbn": "978-5-17-093421-8",
        "description": "Поэма в прозе, сатирическое произведение о похождениях Павла Ивановича Чичикова, скупающего мёртвые души крепостных крестьян.",
        "genre": "Классическая литература",
        "publisher": "Эксмо",
        "publication_year": 2016,
        "page_count": 352,
        "language": "ru",
        "price": 699.0,
        "stock": 20,
        "average_rating": 4.5,
        "tags": ["классика", "сатира", "русская литература", "гоголь"],
    },
    
    # Современная проза
    {
        "title": "Метро 2033",
        "author": "Дмитрий Глуховский",
        "isbn": "978-5-17-088913-3",
        "description": "Постапокалиптический роман о жизни людей в московском метро после ядерной войны. Мир разрушен, человечество почти уничтожено.",
        "genre": "Фантастика",
        "publisher": "АСТ",
        "publication_year": 2015,
        "page_count": 464,
        "language": "ru",
        "price": 799.0,
        "stock": 40,
        "average_rating": 4.6,
        "tags": ["фантастика", "постапокалипсис", "метро", "россия"],
    },
    {
        "title": "Зулейха открывает глаза",
        "author": "Гузель Яхина",
        "isbn": "978-5-17-089956-9",
        "description": "Роман о раскулачивании и ссылке в Сибирь татарской крестьянки Зулейхи. История выживания, любви и обретения свободы.",
        "genre": "Современная проза",
        "publisher": "АСТ",
        "publication_year": 2015,
        "page_count": 508,
        "language": "ru",
        "price": 899.0,
        "stock": 35,
        "average_rating": 4.7,
        "tags": ["современная проза", "история", "россия", "драма"],
    },
    {
        "title": "Дом, в котором...",
        "author": "Мариам Петросян",
        "isbn": "978-5-17-071234-7",
        "description": "Магический реализм. История о подростках, живущих в интернате. Мир, где реальность переплетается с фантазией, а дом становится целой вселенной.",
        "genre": "Современная проза",
        "publisher": "Livebook",
        "publication_year": 2017,
        "page_count": 960,
        "language": "ru",
        "price": 1499.0,
        "stock": 15,
        "average_rating": 4.8,
        "tags": ["магический реализм", "подростки", "интернат", "фэнтези"],
    },
    
    # Детективы и триллеры
    {
        "title": "Шерлок Холмс. Полное собрание сочинений",
        "author": "Артур Конан Дойл",
        "isbn": "978-5-17-092834-7",
        "description": "Полное собрание рассказов и повестей о величайшем сыщике всех времён Шерлоке Холмсе и его верном друге докторе Ватсоне.",
        "genre": "Детектив",
        "publisher": "Эксмо",
        "publication_year": 2016,
        "page_count": 1184,
        "language": "ru",
        "price": 1599.0,
        "stock": 20,
        "average_rating": 4.9,
        "tags": ["детектив", "классика", "холмс", "расследование"],
    },
    {
        "title": "Девушка в поезде",
        "author": "Пола Хокинс",
        "isbn": "978-5-17-091245-2",
        "description": "Психологический триллер о женщине, которая каждый день наблюдает из окна поезда за идеальной парой. Но однажды она становится свидетелем чего-то шокирующего.",
        "genre": "Триллер",
        "publisher": "АСТ",
        "publication_year": 2016,
        "page_count": 416,
        "language": "ru",
        "price": 799.0,
        "stock": 30,
        "average_rating": 4.3,
        "tags": ["триллер", "детектив", "психология", "тайна"],
    },
    {
        "title": "Исчезнувшая",
        "author": "Гиллиан Флинн",
        "isbn": "978-5-389-07892-4",
        "description": "В годовщину свадьбы исчезает жена главного героя. Все улики указывают на него. Но что на самом деле произошло в тот день?",
        "genre": "Триллер",
        "publisher": "Азбука",
        "publication_year": 2015,
        "page_count": 512,
        "language": "ru",
        "price": 899.0,
        "stock": 25,
        "average_rating": 4.4,
        "tags": ["триллер", "психология", "тайна", "детектив"],
    },
    
    # Фэнтези
    {
        "title": "Ведьмак. Последнее желание",
        "author": "Анджей Сапковский",
        "isbn": "978-5-17-098765-8",
        "description": "Сборник рассказов о Геральте из Ривии, профессиональном охотнике на монстров. Первая книга саги о Ведьмаке.",
        "genre": "Фэнтези",
        "publisher": "АСТ",
        "publication_year": 2017,
        "page_count": 384,
        "language": "ru",
        "price": 799.0,
        "stock": 50,
        "average_rating": 4.7,
        "tags": ["фэнтези", "ведьмак", "магия", "монстры", "приключения"],
    },
    {
        "title": "Властелин Колец. Братство Кольца",
        "author": "Дж. Р. Р. Толкин",
        "isbn": "978-5-17-080123-6",
        "description": "Первая часть эпической трилогии о путешествии хоббита Фродо и его спутников, несущих Кольцо Всевластья к Роковой Горе.",
        "genre": "Фэнтези",
        "publisher": "АСТ",
        "publication_year": 2016,
        "page_count": 704,
        "language": "ru",
        "price": 999.0,
        "stock": 45,
        "average_rating": 4.9,
        "tags": ["фэнтези", "эпик", "хоббит", "приключения", "классика"],
    },
    {
        "title": "Игра престолов",
        "author": "Джордж Мартин",
        "isbn": "978-5-17-077234-9",
        "description": "Первая книга эпической саги 'Песнь Льда и Пламени'. Борьба за Железный трон семи королевств Вестероса.",
        "genre": "Фэнтези",
        "publisher": "АСТ",
        "publication_year": 2017,
        "page_count": 896,
        "language": "ru",
        "price": 1199.0,
        "stock": 40,
        "average_rating": 4.8,
        "tags": ["фэнтези", "эпик", "драконы", "интриги", "война"],
    },
    
    # Научная фантастика
    {
        "title": "Дюна",
        "author": "Фрэнк Герберт",
        "isbn": "978-5-17-098456-5",
        "description": "Космическая опера о пустынной планете Арракис, единственном источнике ценнейшего вещества - пряности. История Пола Атрейдеса.",
        "genre": "Фантастика",
        "publisher": "АСТ",
        "publication_year": 2017,
        "page_count": 704,
        "language": "ru",
        "price": 999.0,
        "stock": 35,
        "average_rating": 4.7,
        "tags": ["фантастика", "космос", "пряность", "пустыня", "классика"],
    },
    {
        "title": "Автостопом по галактике",
        "author": "Дуглас Адамс",
        "isbn": "978-5-17-076543-3",
        "description": "Юмористическая научная фантастика о приключениях обычного землянина Артура Дента после уничтожения Земли.",
        "genre": "Фантастика",
        "publisher": "АСТ",
        "publication_year": 2016,
        "page_count": 224,
        "language": "ru",
        "price": 599.0,
        "stock": 30,
        "average_rating": 4.6,
        "tags": ["фантастика", "юмор", "космос", "приключения"],
    },
    {
        "title": "Марсианин",
        "author": "Энди Вейер",
        "isbn": "978-5-17-089234-8",
        "description": "Астронавт Марк Уотни остался один на Марсе. История его выживания и попыток вернуться на Землю.",
        "genre": "Фантастика",
        "publisher": "АСТ",
        "publication_year": 2015,
        "page_count": 464,
        "language": "ru",
        "price": 799.0,
        "stock": 40,
        "average_rating": 4.7,
        "tags": ["фантастика", "марс", "выживание", "космос", "наука"],
    },
    
    # Бизнес и саморазвитие
    {
        "title": "Думай медленно... решай быстро",
        "author": "Даниэль Канеман",
        "isbn": "978-5-17-079876-9",
        "description": "Нобелевский лауреат по экономике объясняет, как работает наш мозг, и почему мы принимаем иррациональные решения.",
        "genre": "Психология",
        "publisher": "АСТ",
        "publication_year": 2014,
        "page_count": 656,
        "language": "ru",
        "price": 1099.0,
        "stock": 25,
        "average_rating": 4.6,
        "tags": ["психология", "мышление", "принятие решений", "нобелевская премия"],
    },
    {
        "title": "Атомные привычки",
        "author": "Джеймс Клир",
        "isbn": "978-5-00146-786-1",
        "description": "Как приобрести хорошие привычки и избавиться от плохих. Практическое руководство по изменению жизни через небольшие действия.",
        "genre": "Психология",
        "publisher": "МИФ",
        "publication_year": 2019,
        "page_count": 320,
        "language": "ru",
        "price": 899.0,
        "stock": 50,
        "average_rating": 4.7,
        "tags": ["саморазвитие", "привычки", "мотивация", "продуктивность"],
    },
    {
        "title": "Как перестать беспокоиться и начать жить",
        "author": "Дейл Карнеги",
        "isbn": "978-5-699-88765-4",
        "description": "Классика литературы по саморазвитию. Практические советы по преодолению стресса и тревожности.",
        "genre": "Психология",
        "publisher": "Эксмо",
        "publication_year": 2016,
        "page_count": 352,
        "language": "ru",
        "price": 699.0,
        "stock": 35,
        "average_rating": 4.5,
        "tags": ["психология", "стресс", "саморазвитие", "классика"],
    },
    
    # Романтика
    {
        "title": "Гордость и предубеждение",
        "author": "Джейн Остин",
        "isbn": "978-5-17-082345-9",
        "description": "Классический роман о любви Элизабет Беннет и мистера Дарси. История о том, как преодолеть гордость и предубеждения.",
        "genre": "Романтика",
        "publisher": "АСТ",
        "publication_year": 2015,
        "page_count": 416,
        "language": "ru",
        "price": 699.0,
        "stock": 30,
        "average_rating": 4.8,
        "tags": ["классика", "романтика", "любовь", "англия"],
    },
    {
        "title": "Виноваты звёзды",
        "author": "Джон Грин",
        "isbn": "978-5-17-087654-6",
        "description": "Трогательная история любви двух подростков, больных раком. Роман о жизни, смерти и смысле существования.",
        "genre": "Романтика",
        "publisher": "АСТ",
        "publication_year": 2014,
        "page_count": 288,
        "language": "ru",
        "price": 599.0,
        "stock": 25,
        "average_rating": 4.6,
        "tags": ["романтика", "драма", "подростки", "любовь"],
    },
    {
        "title": "До встречи с тобой",
        "author": "Джоджо Мойес",
        "isbn": "978-5-389-09123-7",
        "description": "История Луизы Кларк, которая становится сиделкой парализованного Уилла Трейнора. Роман о любви, которая меняет всё.",
        "genre": "Романтика",
        "publisher": "Азбука",
        "publication_year": 2015,
        "page_count": 480,
        "language": "ru",
        "price": 799.0,
        "stock": 30,
        "average_rating": 4.7,
        "tags": ["романтика", "драма", "любовь", "судьба"],
    },
    
    # Ужасы
    {
        "title": "Оно",
        "author": "Стивен Кинг",
        "isbn": "978-5-17-098234-9",
        "description": "В городке Дерри каждые 27 лет пробуждается древнее зло. Семеро друзей детства объединяются, чтобы победить Оно.",
        "genre": "Ужасы",
        "publisher": "АСТ",
        "publication_year": 2017,
        "page_count": 1184,
        "language": "ru",
        "price": 1299.0,
        "stock": 30,
        "average_rating": 4.7,
        "tags": ["ужасы", "стивен кинг", "триллер", "монстр"],
    },
    {
        "title": "Сияние",
        "author": "Стивен Кинг",
        "isbn": "978-5-17-076234-0",
        "description": "Джек Торранс становится смотрителем отеля 'Оверлук' на зиму. Отель начинает влиять на его разум, превращая в монстра.",
        "genre": "Ужасы",
        "publisher": "АСТ",
        "publication_year": 2016,
        "page_count": 512,
        "language": "ru",
        "price": 899.0,
        "stock": 25,
        "average_rating": 4.6,
        "tags": ["ужасы", "стивен кинг", "отель", "безумие"],
    },
    {
        "title": "Дракула",
        "author": "Брэм Стокер",
        "isbn": "978-5-17-074567-2",
        "description": "Классический роман о вампире графе Дракуле. История противостояния древнего зла и современной цивилизации.",
        "genre": "Ужасы",
        "publisher": "АСТ",
        "publication_year": 2015,
        "page_count": 448,
        "language": "ru",
        "price": 699.0,
        "stock": 20,
        "average_rating": 4.5,
        "tags": ["классика", "ужасы", "вампиры", "готика"],
    },
    
    # Приключения
    {
        "title": "Граф Монте-Кристо",
        "author": "Александр Дюма",
        "isbn": "978-5-17-089456-4",
        "description": "История Эдмона Дантеса, несправедливо осуждённого и заключённого в тюрьму, который мстит своим обидчикам после побега.",
        "genre": "Приключения",
        "publisher": "АСТ",
        "publication_year": 2016,
        "page_count": 1312,
        "language": "ru",
        "price": 1399.0,
        "stock": 20,
        "average_rating": 4.9,
        "tags": ["классика", "приключения", "месть", "франция"],
    },
    {
        "title": "Три мушкетёра",
        "author": "Александр Дюма",
        "isbn": "978-5-17-076890-8",
        "description": "Приключения д'Артаньяна и трёх мушкетёров: Атоса, Портоса и Арамиса. Один за всех, и все за одного!",
        "genre": "Приключения",
        "publisher": "Эксмо",
        "publication_year": 2015,
        "page_count": 704,
        "language": "ru",
        "price": 999.0,
        "stock": 25,
        "average_rating": 4.8,
        "tags": ["классика", "приключения", "мушкетёры", "франция"],
    },
    {
        "title": "Остров сокровищ",
        "author": "Роберт Льюис Стивенсон",
        "isbn": "978-5-17-073456-0",
        "description": "Классический приключенческий роман о поиске сокровищ пирата капитана Флинта. История юнги Джима Хокинса и одноногого Джона Сильвера.",
        "genre": "Приключения",
        "publisher": "АСТ",
        "publication_year": 2014,
        "page_count": 256,
        "language": "ru",
        "price": 499.0,
        "stock": 30,
        "average_rating": 4.7,
        "tags": ["классика", "приключения", "пираты", "сокровища"],
    },
    
    # Биографии
    {
        "title": "Стив Джобс",
        "author": "Уолтер Айзексон",
        "isbn": "978-5-17-077234-5",
        "description": "Официальная биография Стива Джобса, основателя Apple. История жизни гения, изменившего мир технологий.",
        "genre": "Биография",
        "publisher": "АСТ",
        "publication_year": 2015,
        "page_count": 688,
        "language": "ru",
        "price": 1199.0,
        "stock": 20,
        "average_rating": 4.7,
        "tags": ["биография", "apple", "технологии", "стив джобс"],
    },
    {
        "title": "Илон Маск: Tesla, SpaceX и дорога в будущее",
        "author": "Эшли Вэнс",
        "isbn": "978-5-17-091234-6",
        "description": "Биография Илона Маска - визионера, предпринимателя и инноватора, меняющего мир.",
        "genre": "Биография",
        "publisher": "Олимп-Бизнес",
        "publication_year": 2016,
        "page_count": 416,
        "language": "ru",
        "price": 999.0,
        "stock": 25,
        "average_rating": 4.6,
        "tags": ["биография", "илон маск", "tesla", "spacex", "инновации"],
    },
]


async def add_books():
    """Добавляет книги в базу данных."""
    
    # Подключаемся к MongoDB
    client = AsyncIOMotorClient(settings.MONGODB_URL)
    
    try:
        # Инициализируем Beanie
        await init_beanie(database=client[settings.DATABASE_NAME], document_models=[Book])
        
        print(f"Добавление {len(BOOKS_TO_ADD)} книг в базу данных...")
        
        added_count = 0
        skipped_count = 0
        
        for book_data in BOOKS_TO_ADD:
            # Проверяем, существует ли уже книга с таким ISBN
            existing = await Book.find_one(Book.isbn == book_data["isbn"])
            
            if existing:
                print(f"[SKIP] Книга уже существует: {book_data['title']}")
                skipped_count += 1
                continue
            
            # Создаём новую книгу
            book = Book(**book_data)
            await book.insert()
            
            print(f"[OK] Добавлена: {book.title} ({book.author})")
            added_count += 1
        
        print(f"\n{'='*60}")
        print(f"Готово!")
        print(f"Добавлено книг: {added_count}")
        print(f"Пропущено (уже существуют): {skipped_count}")
        print(f"Всего в каталоге: {await Book.count()}")
        print(f"{'='*60}\n")
        
    except Exception as e:
        print(f"[ERROR] Ошибка: {e}")
        raise
    finally:
        client.close()


if __name__ == "__main__":
    asyncio.run(add_books())

